<!DOCTYPE html>
<html>
<head>
  <title>QR Code</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">  

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <meta name="apple-mobile-web-app-title" content="QR Test" /> 
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" sizes="57x57" href="../assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="../assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="../assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/icons/apple-icon-180x180.png">

  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="../assets/icons/manifest.json">
  <link rel="icon" type="image/png" sizes="192x192"  href="../assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../assets/icons/favicon-16x16.png">

  <meta name="msapplication-TileImage" content="../assets/icons/ms-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <!-- <link rel="stylesheet" href="index.2.css"> -->
  <style>
    * {
      font-family: 'Apple SD Gothic Neo', 'Helvetica Neue', 'Hiragino Sans', Helvetica, Arial;
      font-size: 15px;
    }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      /*background-color: #fff;*/
      background-color: #f9f9f9;
    }
    section {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      visibility: hidden;
      overflow: hidden;
      background-color: #fff;

      -webkit-backface-visibility: hidden;
      -moz-backface-visibility: hidden;
      backface-visibility: hidden;
      -webkit-transform: translate3d(0, 0, 0);
      -moz-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
      -webkit-transform-style: preserve-3d;
      -moz-transform-style: preserve-3d;
      transform-style: preserve-3d;
    }
    header {
      box-sizing: border-box;
      position: absolute;
      /*display: flex;*/
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 44px;

      /*justify-content: space-around;*/
      justify-content: space-between;
      align-items: stretch;

      /*font-size: 22px;*/
      background-color: #eee;
      border-bottom: 1px solid #f00;
      line-height: 44px;
    }
    .header-center {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 44px;
      font-size: 18px;
      /*font-weight: bold;*/
      text-align: center;
    }
    .header-left {
      position: absolute;
      top: 0;
      left: 0;
      height: 44px;
      /*padding: 0 4px;  */
    }
    .header-right {
      position: absolute;
      top: 0;
      right: 0;
      height: 44px;
      /*padding: 0 4px;  */
    }
    footer {
      box-sizing: border-box;
      position: absolute;
      display: block;
      display: flex;
      /*top: auto;*/
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 44px;
      line-height: 44px;
      /*padding: 4px;*/
      /*justify-content: space-around;*/
      justify-content: space-between;
      background-color: #eee;
      border-top: 1px solid #f00;
    }
    main {
      position: absolute;
      top: 44px;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      overflow: scroll;
      -webkit-overflow-scrolling: touch;
    }
    .main-with-footer {
      bottom: 44px !important;
    }
    button {
      box-sizing: border-box;
      height: 36px;
      line-height: 36px;
      /*padding: 0;*/
      white-space: nowrap;
      border: 1px solid #f00;
      border-radius: 2px;
      /*background-color: #eee;*/
      background-color: #fff;
      color: #f00;
    }
    header button, footer button {
      box-sizing: border-box;
      height: 44px;
      white-space: nowrap;
      background-color: inherit;
      border: 0px solid #f00;
      color: #f00;
    }
    input[type=text], input[type=password] {
      box-sizing: border-box;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 3px;
      /*line-height: 32px;*/
      height: 36px;
      padding: 4px 8px;
    }
    textarea {
      box-sizing: border-box;
      width: 100%;
      font-size: 15px;
      min-height: 88px;
      background-color: #eee;
      border: solid 0px #ccc;
      padding: 8px;
    }
    ol, ul {
      margin: 0;
      padding: 0;

    }
    li {
      box-sizing: border-box;
      list-style: none;
      border-bottom: 1px solid #ccc;
      min-height: 44px;
    }
    .item {
      display: flex;
      justify-content: space-between;
      /*line-height: 43px;*/
      align-items: center;
      box-sizing: border-box;
      width: 100%;
      min-height: 44px;
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    .item-2 {
      box-sizing: border-box;
      width: 100%;
      min-height: 44px;
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    .chevron {
      padding-right: 24px;
    }
    .chevron:before {
      /*content: '❯';*/
      content: '〉';
      display: flex;
      align-items:center;

      position: absolute;
      margin-left: -24px;
      right: 8px;
      color: #f00;
      text-align: right;
      vertical-align: middle;
    }
    li.chevron:before {
      height: 52px;
    }
    .check:after {
      content: '✔';

      position: absolute;
      margin-left: 8px;
      right: 8px;
      color: #f00;
      vertical-align: middle;
    }
    .btn-back {
      background-color: inherit;
      border: 0 solid #fff;
      line-height: 32px;
      width: 44px;
      height: 44px;
      color: #f66;
      text-align: center;
    }
    .page-current { visibility: visible; z-index: 1; }
    .to-left  {-webkit-animation: toLeft .4s ease both;   animation: toLeft .4s ease both;}
    .from-left  {-webkit-animation: fromLeft .4s ease both; animation: fromLeft .4s ease both;}
    .to-right   {-webkit-animation: toRight .4s ease both;  animation: toRight .4s ease both;}
    .from-right {-webkit-animation: fromRight .4s ease both; animation: fromRight .4s ease both;}
    @-webkit-keyframes toLeft {from {} to { -webkit-transform: translateX(-100%); }}
    @-webkit-keyframes toRight  {from {} to { -webkit-transform: translateX(100%); }}
    @-webkit-keyframes fromLeft {from { -webkit-transform: translateX(-100%); }}
    @-webkit-keyframes fromRight{from { -webkit-transform: translateX(100%); } }
    @keyframes toLeft  {from {} to { -webkit-transform: translateX(-100%); transform: translateX(-100%);}}
    @keyframes toRight {from {} to { -webkit-transform: translateX(100%);  transform: translateX(100%);}}
    @keyframes fromLeft  {from{ -webkit-transform: translateX(-100%); transform: translateX(-100%);}}
    @keyframes fromRight {from{ -webkit-transform: translateX(100%);  transform: translateX(100%);}}



    .lbl {
      color: #444;
      /*font-weight: bold;*/
      white-space: nowrap;
    }
    .dat {
      padding-left: 8px;
      text-align: right;
    }
    .c-6 {
      float: left;
      width: 49%;
    }
    .c-6 button {
      width: 100%;
      margin: 4px;
    }

    #dialog-base {
      width: 100%;
    }
    .dialog {
      display: none;
      width: 100%;
    }
    .dlg-frame button {
      min-width: 49%;
      width: 49%;
    }
    #dialog-base {
      z-index: 100;
      background-color: rgba(0,0,0,.125);
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      /*padding: 44px;*/
      display: none;
      /*display: flex;*/
      justify-content: center;
      align-items: center;
    }
    .dlg-frame {
      box-sizing: border-box;
      width: calc(100% - 88px);
      background-color: #fff;
      padding: 8px;
      border-radius: 2px;
      box-shadow: 0px 5px 10px rgba(0,0,0,.5);
    }
    .dlg-title {
      font-size: 22px;
      font-weight: bold;
      text-align: center;
    }
    .dlg-message {
      margin: 8px 0 16px 0;
      max-height: 256px;
      overflow: auto;
    }

    .l-01 {
      display: inline-block;
      width: 110px;
      font-size: 15px;
      font-weight: bold;
      padding: 4px 4px 0px 8px;
      /*border: 1px solid #00f;*/
      line-height: 22px;
    }
    .l-02 {
      display: inline-block;
      width: 50px;
      padding: 4px 4px 0px 4px;
      text-align: right;
      color: #666;
      /*border: 1px solid #00f;*/
      line-height: 22px;
    }
    .l-03 {
      display: inline-block;
      width: 90px;
      padding: 4px 8px 0px 4px;
      /*border: 1px solid #00f;*/
      line-height: 22px;
    }
    .l-04 {
      display: inline-block;
      width: 90px;
      color: #666;
      /*border: 1px solid #00f;*/
      padding: 0px 8px 4px;
      line-height: 21px;
    }
    .l-05 {
      display: inline-block;
      max-width: calc(100% - 110px);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding: 0px 8px 4px 4px;
      /*color: #999;*/
      /*border: 1px solid #00f;*/
      line-height: 21px;
    }

    .spacer {
      height: 200px;
    }
    .btn-color{
      width: 36px;
      color: #fff;
    }
  </style>
</head>

<body style="overflow-y: hidden;">

  <section id="login">
    <div style="text-align: center; width: 200px; margin: 80px auto;">
      <h1 text="login.title" style="font-size: 32px;"></h1>
      <p><input id="pic" type="text" placeholder="pic" value="pic01"></input></p>
      <p><input id="password" type="password" placeholder="password" value="password"></input></p>
      <p>
        <select id="locale" onchange="app.changeLocale(this.value)" style="width: 100%; height: 32px;">
          <option value="ja">日本語</option>
          <option value="en">English</option>
        </select>
      </p>
      <p><button text="common.btn-login" onclick="app.login()" style="width: 100%;"></button></p>
              
      <p style="display:none;">
        ✔&#x2714; ▷&#x25b7; ⊕&#x2295; ⊗&#x2297; 〈&#x2329;〈&#x3008; 〱&#x3031; 〉&#x3009; 〉&#x232a; ☀&#x2600; ☁&#x2601; ❄&#x2744; ↺&circlearrowleft; ⋮&vellip; ⎋&#x238b; ▸&blacktriangleright; ▿&triangledown; ❯&#x276f; ❮&#x276e;
      </p>
        <!-- <button onclick="app.openDialog('dialog-sample')" style="width: 100%;">show dialog logout</button> -->
    </div>
  </section>


  <section id="home">
    <header>
      <div class="header-center" text="home.title">Home</div>
      <div class="header-left"></div>
      <div class="header-right"><button text="common.btn-logout" onclick="app.openDialog('dialog-logout')"></button></div>
    </header>
    <main>
      <div class="item-2">
        <div class="lbl" text="home.progress"></div>
        <canvas id="myChart" style=""></canvas>
      </div>
      <div class="item chevron" onclick="app.showPeriod()">
        <div class="lbl" text="home.ym"></div>
        <div id="ym"></div>
      </div>
      <div class="item chevron" text="home.btn-list" onclick="app.gotoPage('list')"></div>
      <div class="item chevron" text="home.btn-addition" onclick="app.gotoPage('addition')"></div>
      <div class="item-2 chevron" onclick="app.gotoPage('signature')">
        <div class="lbl" text="home.signature" style="padding: 0 0 8px 0;"></div>
        <img src="" alt="signature" style="width: calc(100% - 24px);"/>
      </div>
    </main>
  </section>


  <section id="period">
    <header>
      <div class="header-center" text="period.title"></div>
      <div class="header-left"><button class="btn-back" text="common.btn-back"></button></div>
      <div class="header-right"></div>
    </header>
    <main>
      <ul id="list-period"></ul>
      <div class="spacer"></div>
    </main>
  </section>


  <section id="signature">
    <header>
      <div class="header-center" text="signature.title"></div>
      <div class="header-left"><button class="btn-back" text="common.btn-back"></button></div>
      <div class="header-right"><button text="common.btn-save" onclick="app.saveSignature()"></button></div>
    </header>
    <main class="main-with-footer" style="touch-action: none;">
      <canvas id="canvas-sign" style="width:100%; height: 100%;"></canvas>
    </main>
    <footer>
      <button text="common.btn-clear" style="width: 100%;" onclick="app.clearSignature()"></button>
    </footer>
  </section>


  <section id="list">
    <header>
      <div class="header-center" id="list-data-title" text="list.title"></div>
      <div class="header-left"><button class="btn-back" text="common.btn-back"></button></div>
      <div class="header-right"></div>
    </header>
    <main class="main-with-footer">
      <ul id="list-data"></ul>
      <div class="spacer"></div>
    </main>
    <footer style="display: flex; justify-content: space-between;">
      <input id="search-key" type="text" style="margin: 4px;"/>
      <button text="common.btn-search" onclick="app.searchData()" style="margin-right: 4px;"></button>
    </footer>
  </section>


  <section id="detail">
    <header>
      <div class="header-center" text="detail.title"></div>
      <div class="header-left"><button class="btn-back" text="common.btn-back"></button></div>
      <div class="header-right"></div>
    </header>
    <main class="main-with-footer">
      <div class="item"><div class="lbl" text="detail.d-01"></div><div class="dat" id="d-01"></div></div>
      <div class="item"><div class="lbl" text="detail.d-02"></div><div class="dat" id="d-02"></div></div>
      <div class="item"><div class="lbl" text="detail.d-03"></div><div class="dat" id="d-03"></div></div>
      <div class="item"><div class="lbl" text="detail.d-04"></div><div class="dat" id="d-04"></div></div>
      <div class="item"><div class="lbl" text="detail.d-05"></div><div class="dat" id="d-05"></div></div>
      <div class="item"><div class="lbl" text="detail.d-06"></div><div class="dat" id="d-06"></div></div>
      <div class="item"><div class="lbl" text="detail.d-07"></div><div class="dat" id="d-07"></div></div>
      <div class="item"><div class="lbl" text="detail.d-08"></div><div class="dat" id="d-08"></div></div>
      <div class="item"><div class="lbl" text="detail.d-09"></div><div class="dat" id="d-09"></div></div>
      <div class="item"><div class="lbl" text="detail.d-10"></div><div class="dat" id="d-10"></div></div>
      <div class="item chevron" onclick="app.showFreeText()">
        <div class="lbl" text="detail.d-11" style="color: #d66;"></div>
        <div class="dat" id="d-11"></div>
      </div>
      <div class="spacer"></div>
    </main>
    <footer>
      <button text="detail.btn-reg" style="width: 100%;" onclick="app.openDialog('dialog-confirm')"></button>
    </footer>
  </section>


  <section id="addition">
    <header>
      <div class="header-center" id="list-addition-title" text="addition.title"></div>
      <div class="header-left"><button class="btn-back" text="common.btn-back"></button></div>
      <div class="header-right"><button text="common.btn-add" onclick="app.showAddDetail(-1)"></button></div>
    </header>
    <main>
      <ul id="list-addition"></ul>
      <div class="spacer"></div>
    </main>
  </section>


  <section id="add-detail">
    <header>
      <div class="header-center" text="add-detail.title"></div>
      <div class="header-left"><button class="btn-back" text="common.btn-back"></button></div>
      <div class="header-right">
        <button text="common.btn-save" onclick="app.openDialog('dialog-addition-save')"></button>
        <button id="btn-addition-del" text="common.btn-delete" onclick="app.openDialog('dialog-addition-del')"></button>
      </div>
    </header>
    <main>
      <div class="item-2">
        <div class="my-label" text="add-detail.memo"></div>
        <textarea id="memo"></textarea>
      </div>
      <div class="item">
        <div class="lbl" text="add-detail.picture"></div>
        <div class="right">
          <button text="add-detail.btn-take-photo" id="btn-take-photo" 
            onclick="document.getElementById('file').click();"></button>
          <button text="add-detail.btn-delete-photo" id="btn-remove-photo" 
            style="display: none;" onclick="app.removePhoto()"></button>
        </div>
      </div>
      <div class="item-2">
        <input id="file" type="file" accept="image/*" style="display: none;" 
          onchange="app.handlePicture(this.files[0])">
        <div id="picture-prop" style="font-size: 14px; line-height: 20px; padding: 0 0 8px 0;"></div>
        <img id="picture" style="width: 100%;"/>
      </div>
    </main>
  </section>




  <div class="dialog" id="dialog-free-text">
    <div class="dlg-frame">
      <div class="dlg-title" text="dlg-free-text.title"></div>
      <div class="dlg-message">
        <textarea id="free-text" rows="5"></textarea>
      </div>
      <button text="common.btn-close" onclick="app.closeDialog()"></button>
      <button text="common.btn-ok" onclick="app.copyFreeText()"></button>
    </div>
  </div>


  <div class="dialog" id="dialog-logout">
    <div class="dlg-frame">
      <div class="dlg-title" text="dlg-logout.title"></div>
      <div class="dlg-message" text="dlg-logout.message"></div>
      <button text="common.btn-close" onclick="app.closeDialog()"></button>
      <button text="common.btn-logout" onclick="app.logout()"></button>
    </div>
  </div>


  <div class="dialog" id="dialog-confirm">
    <div class="dlg-frame">
      <div class="dlg-title" text="dlg-confirm.title"></div>
      <div class="dlg-message" text="dlg-confirm.message"></div>
      <button text="common.btn-close" onclick="app.closeDialog()"></button>
      <button text="common.btn-ok" onclick="app.confirmData()"></button>
    </div>
  </div>


  <div class="dialog" id="dialog-addition-save">
    <div class="dlg-frame">
      <div class="dlg-title" text="dlg-addition-save.title"></div>
      <div class="dlg-message" text="dlg-addition-save.message"></div>
      <button text="common.btn-cancel" onclick="app.closeDialog()"></button>
      <button text="common.btn-ok" onclick="app.saveAddition()"></button>
    </div>
  </div>


  <div class="dialog" id="dialog-addition-del">
    <div class="dlg-frame">
      <div class="dlg-title" text="dlg-addition-del.title"></div>
      <div class="dlg-message" text="dlg-addition-del.message"></div>
      <button text="common.btn-cancel" onclick="app.closeDialog()"></button>
      <button text="common.btn-ok" onclick="app.deleteAddition()"></button>
    </div>
  </div>


  <div class="dialog" id="dialog-error">
    <div class="dlg-frame">
      <div class="dlg-title" text="dlg-error.title"></div>
      <div class="dlg-message" id="error-message"></div>
      <button text="common.btn-close" style="width: 100%;" onclick="app.closeDialog()"></button>
    </div>
  </div>

  <div class="dialog" id="dialog-sample">
    <div class="dlg-frame">
      <div class="dlg-title">Sample</div>
      <div class="dlg-message">
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Doloribus voluptatum enim consequatur dolor earum deleniti non iusto, repudiandae maiores veniam. Id accusantium unde sed officia ad necessitatibus aliquid, ab distinctio.
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Doloribus voluptatum enim consequatur dolor earum deleniti non iusto, repudiandae maiores veniam. Id accusantium unde sed officia ad necessitatibus aliquid, ab distinctio.
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Doloribus voluptatum enim consequatur dolor earum deleniti non iusto, repudiandae maiores veniam. Id accusantium unde sed officia ad necessitatibus aliquid, ab distinctio.
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Doloribus voluptatum enim consequatur dolor earum deleniti non iusto, repudiandae maiores veniam. Id accusantium unde sed officia ad necessitatibus aliquid, ab distinctio.
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Doloribus voluptatum enim consequatur dolor earum deleniti non iusto, repudiandae maiores veniam. Id accusantium unde sed officia ad necessitatibus aliquid, ab distinctio.
      </div>
      <button text="common.btn-close" style="width: 100%;" onclick="app.closeDialog()"></button>
    </div>
  </div>

  <div id="dialog-base"></div>

<script src="../assets/lib/Chart.bundle.min.js"></script>
<script src="../assets/lib/jquery-3.1.1.min.js"></script>
<!-- <script src="index.2.js"></script> -->
<script>
"use strict";

// var DATA_ROOT = 'https://php7-my3rd.rhcloud.com/';
var DATA_ROOT = 'https://localhost';

var texts = {
  'en': {
    'common.btn-back': '&#x2329; Back',
    'common.btn-ok': 'OK',
    'common.btn-yes': 'Yes',
    'common.btn-no': 'No',
    'common.btn-cancel': 'Cancel',
    'common.btn-close': 'Close',
    'common.btn-login': 'Log In',
    'common.btn-logout': 'Log Out',
    'common.btn-add': 'Add',
    'common.btn-save': 'Save',
    'common.btn-delete': 'Delete',
    'common.btn-clear': 'Clear',
    'common.btn-search': 'Search',

    'login.title': 'Fixed Assets Check',
    'home.title': 'Home',
    'home.ym': 'Period',
    'home.progress': 'Progress',
    'home.signature': 'Signature',
    'home.lbl-done': 'Done',
    'home.lbl-notyet': 'Not Yet',
    'home.lbl-added': 'Added',
    'home.btn-list': 'Data List',
    'home.btn-addition': 'Addition',
    'home.btn-settings': 'Settings',

    'period.title': 'Operation Period',
    'signature.title': 'Signature',

    'list.title': 'Data List (#)',
    'detail.title': 'Detail',
    'detail.d-01': 'Asset Class Code',
    'detail.d-02': 'Asset Class Text',
    'detail.d-03': 'Asset Code',
    'detail.d-04': 'Asset Text',
    'detail.d-05': 'Inventory Number',
    'detail.d-06': 'Inventory Date',
    'detail.d-07': 'Inventory Note',
    'detail.d-08': 'Quantity',
    'detail.d-09': 'Serial Number',
    'detail.d-10': 'Room',
    'detail.d-11': 'Description',

    'addition.title': 'Addition (#)',
    'add-detail.title': 'Addition Detail',
    'add-detail.memo': 'Memo',
    'add-detail.picture': 'Picture',
    'add-detail.btn-take-photo': 'Choose/Take Photo',
    'add-detail.btn-delete-photo': 'Delete Photo',

    'dlg-free-text.title': 'Free Text',
    'dlg-logout.title': 'Log Out',
    'dlg-logout.message': 'Are you sure?',
    'dlg-confirm.title': 'Save Data',
    'dlg-confirm.message': ' ',
    'dlg-confirm.btn-reg': 'Done',
    'dlg-addition-save.title': 'Save Data',
    'dlg-addition-save.message': 'Are you sure?',
    'dlg-addition-del.title': 'Delete Data',
    'dlg-addition-del.message': 'Are you sure to delete the data?',
    'dlg-error.title': 'Eorror',
  },
  'ja': {
    'common.btn-back': '&#x2329; 戻る',
    'common.btn-yes': 'はい',
    'common.btn-no': 'いいえ',
    'common.btn-ok': 'OK',
    'common.btn-cancel': 'キャンセル',
    'common.btn-close': '閉じる',
    'common.btn-login': 'ログイン',
    'common.btn-logout': 'ログアウト',
    'common.btn-add': '追加',
    'common.btn-save': '保存',
    'common.btn-delete': '削除',
    'common.btn-clear': 'クリア',
    'common.btn-search': '検索',

    'login.title': '固定資産管理',
    'home.title': 'ホーム',
    'home.ym': '期間',
    'home.progress': '進捗',
    'home.signature': 'サイン',
    'home.lbl-done': '完了',
    'home.lbl-notyet': '未完了',
    'home.lbl-added': '追加',
    'home.btn-list': 'データ一覧',
    'home.btn-addition': '追加データ',
    'home.btn-settings': '設定',

    'period.title': '対象期間',
    'signature.title': 'サイン',

    'list.title': 'データ (#)',
    'detail.title': 'データ詳細',
    'detail.d-01': '資産クラス',
    'detail.d-02': '資産クラス名',
    'detail.d-03': '資産',
    'detail.d-04': '資産テキスト',
    'detail.d-05': '棚卸資産番号',
    'detail.d-06': '最終棚卸日',
    'detail.d-07': '棚卸ノート',
    'detail.d-08': '数量',
    'detail.d-09': 'シリアル番号',
    'detail.d-10': '部屋',
    'detail.d-11': 'フリーテキスト',
    'detail.btn-reg': '確認',

    'addition.title': '追加データ (#)',
    'add-detail.title': '追加データ詳細',
    'add-detail.memo': 'メモ',
    'add-detail.picture': '写真',
    'add-detail.btn-take-photo': '写真選択・撮影',
    'add-detail.btn-delete-photo': '写真削除',

    'dlg-free-text.title': 'フリーテキスト',
    'dlg-logout.title': 'ログアウト',
    'dlg-logout.message': 'よろしいですか?',
    'dlg-confirm.title': 'データ確認登録',
    'dlg-confirm.message': ' ',
    'dlg-confirm.btn-reg': '確認完了',
    'dlg-addition-save.title': 'データ保存',
    'dlg-addition-save.message': '保存します。よろしいですか?',
    'dlg-addition-del.title': 'データ削除',
    'dlg-addition-del.message': '削除します。よろしいですか?',
    'dlg-error.title': 'エラー',
  }
};
var el = function(key){ return document.getElementById(key); };

var app = {

  data_root : DATA_ROOT,

  locale : 'ja',
  texts  : {},

  pic    : '',
  periods: [],
  period : '',

  data   : [],
  data_index: -1,

  addition_data: [],
  addition_index : -1,

  pages : ['login'],
  current : 'login',
  isAnimating : false,
  endCurrPage : false,
  endNextPage : false,

  init : function() {
    app.changeLocale('ja');

    $('section').each( function() {
      var $page = $( this );
      $page.data('originalClassList', $page.attr('class'));
      if($page.attr('id')==app.current) $page.addClass('page-current');
    });

    $('.btn-back').each(function(){
      $(this).on('click', app.goBack);
    });
  },
  gotoPage : function(pageId) {
    var current = app.pages[app.pages.length - 1];
    app.moveTo(current, pageId, false);
    app.pages.push(pageId);
  },
  goBack : function() {
    var currPage = app.pages[app.pages.length - 1];
    var nextPage = app.pages[app.pages.length - 2];
    app.moveTo(currPage, nextPage, true);
    app.pages.pop();
  },
  moveTo : function(currPage, nextPage, isBack) {
    if( app.isAnimating ) return;
    app.isAnimating = true;
    var $currPage = $('#' + currPage);
    var $nextPage = $('#' + nextPage).addClass('page-current');
    var onEndAnimation = function ( $cPage, $nPage ) {
      app.endCurrPage = false;
      app.endNextPage = false;
      $cPage.removeAttr('class');
      $nPage.attr('class', 'page-current');
      app.isAnimating = false;
    };
    $currPage.addClass(isBack ? 'to-right' : 'to-left').on('animationend', function() {
      $currPage.off('animationend');
      app.endCurrPage = true;
      if(app.endNextPage) onEndAnimation($currPage, $nextPage);
    });
    $nextPage.addClass(isBack ? 'from-left' : 'from-right').on('animationend', function() {
      $nextPage.off('animationend');
      app.endNextPage = true;
      if(app.endCurrPage) onEndAnimation($currPage, $nextPage);
    });
  },

  changeLocale : function(locale) {
    app.locale = locale;
    app.texts = texts[locale];
    app.setTexts();
  },
  setTexts : function() {
    $('[text]').each(function(){
      var $el = $(this);
      var key = $el.attr('text');
      $el.html(app.texts[key]);
      // console.log(key, app.texts[key]);
    });
  },
  openDialog  : function(id) {
    $('#dialog-base')
      .html(el(id).innerHTML)
      .css({'display': 'flex'});
  },
  closeDialog : function() {
    $('#dialog-base')
      .html('')
      .css({'display': 'none'});
  },
  handleError : function(err, b, c) {
    console.log(err, b, c);
    el('error-message').innerHTML = err.message;
    app.openDialog('dialog-error');
  },

  // login page
  login : function() {
    $.ajax({
      url: app.data_root + '/api/fac/auth/client',
      method: 'POST',
      data: {
        account: $('#pic').val(),
        password: $('#password').val()
      },
      error : app.handleError,
      success : function(a, b, c) {
        console.log('success', a, b, c);
        app.periods = [];
        a.forEach(function(row){
          app.periods.push(row.ym);
        });
        console.log('login', $('#pic').val());
        app.pic = $('#pic').val();
        app.gotoPage('home');
      }
    });
  },
  // period list page
  showPeriod : function() {
    var h = '', p;
    for(var i=0, ii=app.periods.length; i<ii; i++){
      p = app.periods[i];
      h +='<li class="item' + (p==app.period ? ' check' : '') + '" onclick="app.changePeriod(' + p + ')">' + p + '</li>';
    }
    el('list-period').innerHTML = h;
    app.gotoPage('period');
  },
  changePeriod : function(p) {
    app.period = p;
    console.log(app.period, app.pic);
    $.ajax(app.data_root + '/api/fac/' + app.period + '/' + app.pic)
    .fail(app.handleError)
    .done(function(json) {
      el('ym').innerHTML = app.period;
      app.data = json.data;
      app.addition_data = json.addition;
      app.initList();
      app.initAdditionList();
      app.drawChart();
      app.goBack();
    });
  },
  // home page
  logout : function() {
    app.closeDialog();
    app.goBack();
  },
  drawChart : function() {
    var conf = {
        type: ['bar','line','pie','doughnut'][3],
        data: {
            labels: [
              app.texts['home.lbl-done'],
              app.texts['home.lbl-notyet'],
              app.texts['home.lbl-added']
            ],
            datasets: [{
                label: 'data count',
                data: [
                  Math.ceil(app.data.length*2/3),
                  Math.floor(app.data.length/3),
                  app.addition_data.length
                ],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132,1)',
                    'rgba(54,162,235,1)',
                    'rgba(255,206,86,1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
          legend: {
            position: ['top', 'bottom', 'left', 'right'][1]
          }
        }
    };
    new Chart(document.getElementById("myChart"), conf);
  },
  // list page
  initList : function() {
    var h = '';
    for(var i=0, ii=app.data.length; i<ii; i++){
      h += '<li class="chevron">' + app.buildListHtml(app.data[i]) + '</li>';
    }
    el('list-data').innerHTML = h;

    var $list = $('#list-data>li');
    $list.on('click', function(a,b,c){
      app.showDetail($list.index(this));
    });

    el('list-data-title').innerHTML = app.texts['list.title'].replace('#', app.data.length);
  },
  updateList : function() {
    var index = app.data_index;
    var d = app.data[index];
    var h = app.buildListHtml(d);
    $('#list-data').children().eq(index).html(h);
    console.log(index, d, h);
  },
  buildListHtml : function(d) {
    var h = '<div>' +
        '<span class="l-01">' + d.inventory_number + '</span>' +
        '<span class="l-02">' + d.quantity + ' ' + d.unit + '</span>' +
        '<span class="l-03">' + (d.inventory_date ? d.inventory_date : '&nbsp;') + '</span>' +
      '</div>' +
      '<div style="display: flex;">' +
        '<span class="l-04">' + d.asset_class_code + '</span>' +
        '<span class="l-05">' + d.char30k + '</span>' +
      '</div>';
    return h;
  },
  searchData : function() {
    var key = el('search-key').value;
    var i = 0;
    // search data that matches the decoded text
    var found = app.data.filter(function(dat, index){
      if (key == dat.asset_code + '-' + dat.asset_sub){
        i = index;
        return true;
      }
      return false;
    });
    console.log(found);
    // navigate to detail page
    if(found.length == 1) {
      app.showDetail(i);
    } else {
      var msg = (found.length === 0 ? 'Not Found' 
        : 'there are ' + found.length + ' ' + keys + ' in the list');
      el('dlg-error-message').innerHTML = msg;
      app.openDialog('dialog-error')
    }
  },
  // detail page
  showDetail : function(index) {
    app.data_index = index;
    var d = app.data[index];
    el('d-01').innerHTML = d.asset_class_code;
    el('d-02').innerHTML = d.asset_class_text;
    el('d-03').innerHTML = d.asset_code;
    el('d-04').innerHTML = d.asset_text;
    el('d-05').innerHTML = d.inventory_number;
    el('d-06').innerHTML = d.inventory_date;
    el('d-07').innerHTML = d.inventory;
    el('d-08').innerHTML = d.quantity + ' ' + d.unit;
    el('d-09').innerHTML = d.serial_number;
    el('d-10').innerHTML = d.room;
    el('d-11').innerHTML = d.char30k;
    app.gotoPage('detail');
  },
  showFreeText : function() {
    app.openDialog('dialog-free-text');
    $('#dialog-base #free-text').val(el('d-11').innerHTML);
  },
  copyFreeText : function() {
    el('d-11').innerHTML = $('#dialog-base #free-text').val();
    app.closeDialog();
  },
  confirmData : function() {
    var getISODate = function(){
      var t = new Date(),
        y = t.getFullYear(),
        m = t.getMonth() + 1,
        d = t.getDate();
      return '' + y + '-' + (m<10 ? '0' : '') + m + '-' + (d<10 ? '0' : '') + d;
    };
    var dat = app.data[app.data_index];
    dat.inventory_date = getISODate();
    dat.char30k = el('d-11').innerHTML;
    app.updateList();
    app.closeDialog();
    app.goBack();
  },
  // addition page
  initAdditionList : function() {
    var dat = app.addition_data, h = '';
    for(var i=0, ii=dat.length; i<ii; i++){
      h += '<li class="chevron">' + app.buildAdditionHtml(dat[i]) + '</li>';
    }
    el('list-addition').innerHTML = h;

    var $list = $('#list-addition>li');
    $list.on('click', function(){
      app.showAddDetail($list.index(this));
    });

    el('list-addition-title').innerHTML = app.texts['addition.title'].replace('#', dat.length);
  },
  updateAddition : function() {
    var index = app.addition_index;
    var d = app.addition[index];
    var h = app.buildAdditionHtml(d);
    $('#list-addition').children().eq(index).html(h);
    console.log(index, d, h);
  },
  buildAdditionHtml : function(dat) {
    return '<div>' + dat.memo + '</div>';
  },
  showAddDetail : function(index) {
    app.addition_index = index;
    if(app.addition_index < 0) {
      $('#btn-addition-del').hide();
    } else {
      $('#btn-addition-del').show();
      var dat = app.addition_data[index];
      el('memo').value = dat.memo;
      if(dat.file_name && dat.file !== '') {
        // el('picture').src = app.data_root + '/upload/fac/'
      }
    }
    app.gotoPage('add-detail');
  },
  handlePicture : function(file) {
    console.log(file);
    if(file){
      var name = file.name,
          size = Math.round(file.size/1024) + ' kb',
          demension = '',
          str = 'Name: ' + name + '<br/>Size: ' + size + '<br/>Demension: ';
      el('btn-take-photo').style.display = 'none';
      el('btn-remove-photo').style.display = 'block';
      var img = el('picture');
      img.onload = function () {
        str += 'w:' + img.width + " h:" + img.height;
        el('picture-prop').innerHTML = str;
      };
      img.src = URL.createObjectURL(file);
    }
  },
  removePhoto : function() {
      el('file').value = '';
      el('btn-take-photo').style.display = 'block';
      el('btn-remove-photo').style.display = 'none';
      el('picture-prop').innerHTML = '';
      el('picture').src = '';
  },
  saveAddition : function() {
    if(app.addition_index >= 0) {

    }
    // format request body
    var file = null;
    var fd = new FormData();
    fd.append('memo', el('memo').value);
    fd.append('file', file);
    // send data to server then get thumbnail in callback
    $.ajax({
      url: app.data_root + '/api/addition',
      method: 'POST',
      dataType : 'text',
      data : fd,
      processData : false,
      contentType : false,
    })
    .fail(app.handleError)
    .done(function(a, b, c) {
      el('memo').innerHTML = '';
      app.removePhoto();
      app.updateAddition();
      app.goBack();
    });
  },
  deleteAddition : function() {
    $.ajax({
      url: app.data_root + '/api/addition',
      method: 'DELETE',
      data : app.data[app.data_index],
    })
    .fail(app.handleError)
    .done(function(a, b, c) {
      el('memo').innerHTML = '';
      app.removePhoto();
      app.goBack();
    });
  },
  compressImage : function(img) {
    var tmp = {}
    tmp.canvas = document.createElement('canvas');
    var MAX_WIDTH = 800;
    var MAX_HEIGHT = 600;
    var width = img.width;
    var height = img.height;
    if (width > height) {
      if (width > MAX_WIDTH) {
        height *= MAX_WIDTH / width;
        width = MAX_WIDTH;
      }
    } else {
      if (height > MAX_HEIGHT) {
        width *= MAX_HEIGHT / height;
        height = MAX_HEIGHT;
      }
    }
    tmp.canvas.width = width;
    tmp.canvas.height = height;
    // el_scale.innerHTML = 'w:' + width + ' h:' + height;

    var ctx = tmp.canvas.getContext("2d");
    ctx.drawImage(img, 0, 0, width, height);
    var imgData = ctx.createImageData(width, height);
    var pixels  = ctx.getImageData(0, 0, width, height);
    var data = imgData.data;

    for (var i = 0, l = pixels.data.length; i < l; i += 4) {
      var r = pixels.data[i + 0];
      var g = pixels.data[i + 1];
      var b = pixels.data[i + 2];
      data[i + 0] = (r * .393) + (g *.769) + (b * .189);
      data[i + 1] = (r * .349) + (g *.686) + (b * .168);
      data[i + 2] = (r * .272) + (g *.534) + (b * .131);
      data[i + 3] = 255;
    }
    ctx.putImageData(imgData, 0, 0);
    var dataurl = tmp.canvas.toDataURL("image/png");
    // console.log(imgData, pixels, dataurl);
    delete tmp.canvas;
    return dataurl;
    // e = Date.now();
    // el_time.innerHTML = (e-s) + ' ms';
    // el_resize.innerHTML = Math.round(dataurl.length/1024) + ' kb';
  },
  // signature page
  initSignature : function() {
    console.log('initSignature');

    var $canvas = $('#canvas-sign');
    var enable = false;
    var prev = {} , current = {};
    var isTouch = 'ontouchend' in document;
    console.log('isTouch', isTouch);
    $canvas.attr('width', $canvas.width());
    $canvas.attr('height', $canvas.height());

    var canvas = el('canvas-sign'),
      ctx = canvas.getContext("2d");
    console.log('canvas', canvas);
    ctx.strokeStyle = "#000";
    ctx.lineJoin    = "round";
    ctx.lineWidth   = 5;

    var drawLine = function(){
      if (!enable) return;
      console.log('draw', prev.x, prev.y, current.x, current.y);
      ctx.beginPath();
      ctx.moveTo(prev.x, prev.y);
      ctx.lineTo(current.x, current.y);
      ctx.closePath();
      ctx.stroke();
    }
    var getPoint = function(e) {
      console.log(e);
      e.preventDefault();
      return {x: e.touches[0].pageX, y: e.touches[0].pageY - 44};
    };
    canvas.addEventListener((isTouch ? 'touchstart' : 'mousedown'), function(e){
      enable = true;
      prev = getPoint(e);
    }, false);
    canvas.addEventListener((isTouch ? 'touchmove' : 'mousemove'), function(e){
      current = getPoint(e);
      drawLine();
      prev = current;
    }, false);
    canvas.addEventListener((isTouch ? 'touchend' : 'mouseup'), function(e){
      current = getPoint(e);
      drawLine();
      enable = false;
    }, false);
    canvas.addEventListener((isTouch ? 'touchend' : 'mouseleave'), function(e){
      current = getPoint(e);
      drawLine();
      enable = false;
    }, false);
  },
  clearSignature : function() {
    var canvas = el('canvas-sign');
    var ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  },
  saveSignature : function() {
    var dataURL = el('canvas-sign').toDataURL('image/png');
    console.log(dataURL, dataURL.length);

    var bin = atob(dataURL.replace(/^.*,/, ''));
    var buffer = new Uint8Array(bin.length);
    for (var i = 0; i < bin.length; i++) {
        buffer[i] = bin.charCodeAt(i);
    }
    var blob = new Blob([buffer.buffer], {type: 'image/png'});

    var fd = new FormData();
    fd.append("image", blob);

    $.ajax({
      url: app.data_root + '/api/fac/' + app.period + '/' + app.pic,
      method : 'POST',
      data : fd,
      success : function(dat) {

      },
      error: function(err) {

      }
    });
  },
};

app.init();
app.initSignature();
</script>
</body>
</html>
