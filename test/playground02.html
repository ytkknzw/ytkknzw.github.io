<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">  

	<title>Apps</title>

	<style>
		* {
			font-family: Arial;
		}
		.lbl {
			display: inline-block;
			min-width: 70px;
			text-align: right;
			font-weight: bold;
			line-height: 26px;
		}
		button {
			border-radius: 4px;
			border: solid 1px #ccc;
			background-color: #ddd;
		}
	</style>
</head>
<body>


<div style="padding: 12px;">

	<div><span class="lbl">Demension :&nbsp;</span><span id="wh"></span></div>
	<div><span class="lbl">Name : &nbsp;</span><span id="fname"></span></div>
	<div><span class="lbl">Type : &nbsp;</span><span id="type"></span></div>
	<div><span class="lbl">Size : &nbsp;</span><span id="size"></span></div>
	<div><span class="lbl">resize : &nbsp;</span><span id="resize"></span></div>
	<div><span class="lbl">scale : &nbsp;</span><span id="scale"></span></div>
	<div><span class="lbl">Time : &nbsp;</span><span id="time"></span></div>
	<br/>
	<!-- <img id="image" src="S__18644996.jpg" style="width: 300px;"/> -->
	<input type="file" accept="image/*" onchange="handleFile(this.files[0])">
	<button onclick="hermite_resize(640, 480)">RESIZE TEST</button>
	<div id="frame"></div>
</div>

<script src="hermite.js"></script>
<script>

	var el = function(key) { return document.getElementById(key); };
	var result 	= el('result'),
		ms 		= el('time'),
		fname 	= el('fname'),
		size 	= el('size'),
		resize 	= el('resize'),
		scale 	= el('scale'),
		type 	= el('type'),
		wh		= el('wh');

	function handleFile(file) {
		console.log(file);
		fname.innerHTML = file.name;
		type.innerHTML = file.type;
		if(file.type.split('/')[0] != 'image'){
			alert(file.type + ' !');
			return;
		}
		size.innerHTML = Math.round(file.size/1024) + ' kb';
		var b = (file.size > 1024*1024);

        var img = new Image();
        img.onload = function () {
        	wh.innerHTML = 'w:' + img.width + " h:" + img.height;
        	// var s = file.size / (1024*1024);
        	// var s = (img.width > img.height ? img.width : img.height) / (320 - 34);
        	// console.log('scale', s);
        	// scale.innerHTML = (1/s);
        	hermite_resize(img);
        };
        img.src = URL.createObjectURL(file);
	}

	function hermite_resize(img) {
		var hermite = Hermite.init('hermite-worker.js');
		hermite.resize({
			source: img,
			// source: document.getElementById('image'), // any canvas or image elements, jQuery or native
			width: img.width/8, //400,
			height: img.height/8, //600,
			// output: 'image', // [optional] `image` or `canvas`. If not entered output is same as input element.
			quality: 0.5, // [optional] applicable for `image` output only
		}, function(output) {
			//your callback
			resize.innerHTML = Math.round(output.src.length/1024) + ' kb';
			console.log(output, output.width, output.height);
			document.getElementById('frame').innerHTML = '';
			document.getElementById('frame').appendChild(output);
		});
	}

</script>
</body>
</html>